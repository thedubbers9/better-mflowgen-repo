#! /usr/bin/env bash
set -euo pipefail
#=========================================================================
# mflowgen-run
#=========================================================================
# Generator : /afs/ece.cmu.edu/usr/edubbers/private/CODESIGN_PROJ/BETTER_mflowgen/mflowgen/mflowgen/core/build_orchestrator.py

# Pre

rm -f .time_end
date +%Y-%m%d-%H%M-%S > .time_start
MFLOWGEN_STEP_HOME=$PWD
export design_name=mult_16b_flopped
export lvs_hcells_file=
export lvs_connect_names=
export lvs_verify_netlist=1
export lvs_extra_spice_include=

# Commands

if [ -z "$lvs_hcells_file" ]; then export lvs_use_hcells=0; else export lvs_use_hcells=1; fi
if [ -z "$lvs_connect_names" ]; then export lvs_connect_names_state=NONE; else export lvs_connect_names_state=SOME; fi
envsubst < lvs.runset.template > lvs.runset
if [ ! -f inputs/*.svrf ]; then touch inputs/rules.svrf; fi
cat inputs/*.lvs.v > merged.lvs.v
calibre -gui -lvs -batch -runset lvs.runset
mkdir -p outputs && cd outputs
ln -sf ../lvs.report
ln -sf ../_merged.lvs.v.sp design.schematic.spi
ln -sf ../merged.lvs.v design_merged.lvs.v

# Post

cd $MFLOWGEN_STEP_HOME
date +%Y-%m%d-%H%M-%S > .time_end

